# ğŸ›¢ï¸ æ²¹ç”°æœåŠ¡ RAG ç³»ç»Ÿ

ä¸€ä¸ªä¸“ä¸ºæ²¹ç”°æœåŠ¡é¢†åŸŸè®¾è®¡çš„å¤šæ¨¡æ€ RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰é—®ç­”ç³»ç»Ÿã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å‡†å¤‡æ•°æ®

æŠŠç»„å§”ä¼šæä¾›çš„æ•°æ®æ”¾åˆ° `data/` æ–‡ä»¶å¤¹ï¼š

```
data/
â”œâ”€â”€ *.pdf          # PDF æ–‡æ¡£ï¼ˆæ”¯æŒè¡¨æ ¼æå–ï¼‰
â”œâ”€â”€ *.xlsx         # Excel æ•°æ®
â”œâ”€â”€ *.csv          # CSV æ•°æ®
â”œâ”€â”€ *.docx         # Word æ–‡æ¡£
â”œâ”€â”€ *.md           # Markdown æ–‡æ¡£
â”œâ”€â”€ *.pptx         # PowerPoint
â”œâ”€â”€ *.png / *.jpg  # å›¾ç‰‡ï¼ˆVLM è‡ªåŠ¨ç”Ÿæˆæè¿°ï¼‰
â””â”€â”€ subfolders/    # æ”¯æŒå­æ–‡ä»¶å¤¹
```

### 2. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

å¯é€‰ï¼ˆå›¾ç‰‡ OCRï¼Œæå‡å›¾ç‰‡é—®ç­”è¦†ç›–ï¼‰ï¼š

```bash
# macOS
brew install tesseract
python3 -m pip install pytesseract
```

### 3. å¯åŠ¨ Ollama

```bash
# ç»ˆç«¯ 1: å¯åŠ¨ Ollama æœåŠ¡
ollama serve

# ç»ˆç«¯ 2: ä¸‹è½½æ¨¡å‹
ollama pull qwen2.5:3b
ollama pull llava  # å¯é€‰ï¼Œç”¨äºå›¾ç‰‡ç†è§£
```

### 4. è¿è¡Œç³»ç»Ÿ

```bash
# æ–¹å¼ 1: å‘½ä»¤è¡Œäº¤äº’
python app.py

# æ–¹å¼ 2: Web UI
python app.py --mode web
# æˆ–
streamlit run streamlit_app.py

# æ–¹å¼ 3: ç›´æ¥æé—®
python app.py --question "SLB çš„ 2023 å¹´è¥æ”¶æ˜¯å¤šå°‘ï¼Ÿ"
```

### 5. æ‰¹é‡å›ç­” Excel

æ¯”èµ›é¢˜ç›® Excelï¼ˆåˆ—ï¼šno./question/answerï¼‰å¯ç›´æ¥å›å†™ç­”æ¡ˆï¼š

```bash
python3 batch_answer_excel.py --input data/questions.xlsx
```

é»˜è®¤é…ç½®åœ¨ `config/config.yaml` çš„ `batch_answer`ï¼Œæ”¯æŒæ–­ç‚¹ç»­è·‘ä¸å®šæœŸä¿å­˜ã€‚

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
RAG-study/
â”œâ”€â”€ data/                    # ğŸ‘ˆ æŠŠæ•°æ®æ”¾è¿™é‡Œï¼
â”‚   â”œâ”€â”€ documents/
â”‚   â””â”€â”€ images/
â”œâ”€â”€ config/
â”‚   â””â”€â”€ config.yaml          # ç»Ÿä¸€é…ç½®æ–‡ä»¶
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ loaders/             # æ•°æ®åŠ è½½æ¨¡å—
â”‚   â”œâ”€â”€ retrieval/           # æ£€ç´¢æ¨¡å—
â”‚   â”œâ”€â”€ generation/          # ç”Ÿæˆæ¨¡å—
â”‚   â””â”€â”€ evaluation/          # è¯„æµ‹æ¨¡å—
â”œâ”€â”€ app.py                   # ä¸»åº”ç”¨å…¥å£
â”œâ”€â”€ streamlit_app.py         # Web UI
â”œâ”€â”€ benchmark_challenge.py   # è¯„æµ‹è„šæœ¬
â”œâ”€â”€ rag_eval.py              # RAG è¯„æµ‹è„šæœ¬ (LLM-as-a-judge)
â”œâ”€â”€ batch_answer_excel.py    # æ‰¹é‡å›ç­” Excel
â”œâ”€â”€ requirements.txt         # ä¾èµ–æ¸…å•
â”œâ”€â”€ TEAM_GUIDE.md           # å›¢é˜Ÿåˆ†å·¥æŒ‡å—
â””â”€â”€ README.md
```

---

## âš™ï¸ é…ç½®è¯´æ˜

ç¼–è¾‘ `config/config.yaml` æ¥è°ƒæ•´ç³»ç»Ÿè¡Œä¸ºï¼š

```yaml
# æ¨¡å‹é…ç½®
models:
  llm:
    model_name: "qwen2.5:3b"  # å¯ä»¥æ¢æˆå…¶ä»–æ¨¡å‹
  embedding:
    model_name: "sentence-transformers/all-MiniLM-L6-v2"

# æ£€ç´¢é…ç½®
retrieval:
  k_excel: 10      # Excel æ•°æ®å¬å›æ•°é‡
  k_word: 5        # Word æ–‡æ¡£å¬å›æ•°é‡

# æ‰¹é‡é—®ç­”ï¼ˆExcelï¼‰
batch_answer:
  input_path: "data/questions.xlsx"
  output_path: ""  # ç•™ç©ºåˆ™è¦†ç›–è¾“å…¥æ–‡ä»¶
  question_col: "question"
  answer_col: "answer"
  resume: true
  save_every: 5

# Prompt é…ç½®ï¼ˆå¯è‡ªå®šä¹‰ï¼‰
prompts:
  generation: |
    You are a Senior Technical Expert...
```

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·é—®é¢˜                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Query Decomposition (é—®é¢˜åˆ†è§£)                              â”‚
â”‚  å¤æ‚é—®é¢˜ â†’ å¤šä¸ªå­é—®é¢˜                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼                    â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‘é‡æ£€ç´¢    â”‚      â”‚   BM25      â”‚      â”‚   HyDE      â”‚
â”‚  (åˆ†ç»„å¬å›)  â”‚      â”‚  å…³é”®è¯     â”‚      â”‚  å‡è®¾æ–‡æ¡£    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                    â”‚                    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   RRF èåˆ      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Reranker ç²¾æ’  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  CRAG è‡ªæˆ‘ä¿®æ­£  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  LLM ç”Ÿæˆå›ç­”   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ æ ¸å¿ƒä¼˜åŒ–

| ä¼˜åŒ–é¡¹ | è¯´æ˜ | æ•ˆæœ |
|--------|------|------|
| **Query Decomposition** | å¤æ‚é—®é¢˜æ‹†åˆ†ä¸ºå­é—®é¢˜ | æé«˜å¤æ‚é—®é¢˜è¦†ç›–ç‡ |
| **HyDE** | ç”Ÿæˆå‡è®¾æ–‡æ¡£åæ£€ç´¢ | æé«˜è¯­ä¹‰åŒ¹é…å‡†ç¡®åº¦ |
| **RRF èåˆ** | å¤šè·¯å¬å›æŒ‰æ’åèåˆ | ç»¼åˆå¤šç§æ£€ç´¢ä¼˜åŠ¿ |
| **PDF è¡¨æ ¼æå–** | è¡¨æ ¼è½¬ç»“æ„åŒ–æ–‡æœ¬ | ç²¾å‡†æ£€ç´¢è¡¨æ ¼æ•°æ® |
| **Parent-Child åˆ†å—** | å°å—æ£€ç´¢ï¼Œå¤§å—ç”Ÿæˆ | æ£€ç´¢ç²¾å‡† + ä¸Šä¸‹æ–‡å®Œæ•´ |

---

## ğŸ‘¥ å›¢é˜Ÿåˆ†å·¥

è¯¦è§ [TEAM_GUIDE.md](TEAM_GUIDE.md)

| è§’è‰² | è´Ÿè´£æ¨¡å— |
|------|---------|
| æˆå‘˜A | æ•°æ®åŠ è½½ (`src/loaders/`) |
| æˆå‘˜B | æ£€ç´¢ä¼˜åŒ– (`src/retrieval/`) |
| æˆå‘˜C | Prompt å·¥ç¨‹ (`src/generation/`) |
| æˆå‘˜D | è¯„æµ‹è°ƒä¼˜ (`src/evaluation/`) |
| æˆå‘˜E | ç³»ç»Ÿé›†æˆ (`app.py`, `config/`) |

---

## ğŸ“Š è¯„æµ‹

```bash
# è¿è¡Œè¯„æµ‹ï¼ˆæ—§ï¼‰
python benchmark_challenge.py

# è¿è¡Œè¯„æµ‹ï¼ˆé€šç”¨ LLM-as-a-judgeï¼‰
python rag_eval.py

# è¾“å‡ºç¤ºä¾‹
ğŸ§ª Testing: æ¯”è¾ƒç±»é—®é¢˜
â“ Question: Compare the revenue of Latin America vs Middle East...
ğŸ¤– Answer: Based on the Q3 2024 data, Latin America showed 12% growth...
ğŸ“ Score: 9/10
```

---

## ğŸ› å¸¸è§é—®é¢˜

**Q: Ollama è¿æ¥å¤±è´¥**
```bash
# ç¡®ä¿ Ollama æ­£åœ¨è¿è¡Œ
ollama serve
```

**Q: å›¾ç‰‡æ²¡æœ‰æè¿°**
```bash
# ä¸‹è½½ VLM æ¨¡å‹
ollama pull llava
```

**Q: æƒ³è¦å›¾ç‰‡ OCR**
```bash
brew install tesseract
python3 -m pip install pytesseract
```

**Q: æ£€ç´¢æ•ˆæœä¸å¥½**
- æ£€æŸ¥ `config/config.yaml` ä¸­çš„å¬å›å‚æ•°
- å°è¯•è°ƒæ•´ `rrf.weights` ä¸­çš„æƒé‡

---

## ğŸ“ License

MIT
