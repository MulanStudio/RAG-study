# =====================================================
# ğŸ›¢ï¸ æ²¹ç”°æœåŠ¡ RAG ç³»ç»Ÿ - ç»Ÿä¸€é…ç½®æ–‡ä»¶
# =====================================================
# ä½¿ç”¨æ–¹æ³•ï¼šä¿®æ”¹æ­¤æ–‡ä»¶å³å¯è°ƒæ•´ç³»ç»Ÿè¡Œä¸ºï¼Œæ— éœ€æ”¹ä»£ç 

# -----------------------------------------------------
# ğŸ“‚ æ•°æ®è·¯å¾„é…ç½®
# -----------------------------------------------------
data:
  # æ•°æ®æ ¹ç›®å½•ï¼ˆæŠŠç»„å§”ä¼šçš„æ•°æ®æ”¾è¿™é‡Œï¼‰
  root_dir: "data/"
  
  # æ”¯æŒçš„æ–‡ä»¶ç±»å‹
  supported_formats:
    documents: ["pdf", "docx", "xlsx", "csv", "md", "pptx"]
    images: ["png", "jpg", "jpeg"]
    videos: ["mp4"]  # æš‚ä¸æ”¯æŒ

# -----------------------------------------------------
# ğŸ¤– æ¨¡å‹é…ç½®
# -----------------------------------------------------
models:
  # LLM é…ç½® (æœ¬åœ° Ollama)
  llm:
    provider: "ollama"
    model_name: "qwen2.5:3b"
    base_url: "http://127.0.0.1:11434"
    temperature: 0.1  # ä½æ¸©åº¦ = æ›´ç¡®å®šæ€§çš„å›ç­”
  
  # VLM é…ç½® (å›¾ç‰‡ç†è§£)
  vlm:
    enabled: true
    model_name: "llava"
    base_url: "http://127.0.0.1:11434"
  
  # Embedding æ¨¡å‹
  embedding:
    # è‹±æ–‡è¯­æ–™ä¼˜å…ˆï¼ˆæ›´é€‚åˆè‹±æ–‡è¯­ä¹‰æ£€ç´¢ï¼‰
    model_name: "sentence-transformers/all-MiniLM-L6-v2"
  
  # Reranker æ¨¡å‹
  reranker:
    # è‹±æ–‡è¯­æ–™ä¼˜å…ˆï¼ˆè½»é‡çº§ Cross-Encoderï¼‰
    model_name: "cross-encoder/ms-marco-MiniLM-L-6-v2"

# -----------------------------------------------------
# ğŸ“‘ æ–‡æ¡£å¤„ç†é…ç½®
# -----------------------------------------------------
indexing:
  # Parent-Child åˆ†å—ç­–ç•¥
  chunk_size_parent: 2000    # çˆ¶å—å¤§å°ï¼ˆç”¨äºç”Ÿæˆï¼‰
  chunk_overlap_parent: 200
  chunk_size_child: 400      # å­å—å¤§å°ï¼ˆç”¨äºæ£€ç´¢ï¼‰
  chunk_overlap_child: 50

# -----------------------------------------------------
# ğŸ” æ£€ç´¢é…ç½®
# -----------------------------------------------------
retrieval:
  # åˆ†ç»„å¬å› Top-K
  k_excel: 10      # Excel/CSV æ•°æ®
  k_word: 5        # Word åˆåŒ
  k_image: 3       # å›¾ç‰‡æè¿°
  k_tech: 5        # æŠ€æœ¯æ–‡æ¡£
  k_general: 5     # é€šç”¨
  
  # è´¢åŠ¡é—®é¢˜åŠ¨æ€åŠ æƒ
  k_financial_boost: 15
  
  # RRF èåˆå‚æ•°
  rrf:
    k: 60          # RRF å¸¸æ•°
    weights:
      vector: 1.0
      bm25: 0.8
      hyde: 1.2
  
  # HyDE é…ç½®
  hyde:
    enabled: true

# -----------------------------------------------------
# ğŸ“ Prompt æ¨¡æ¿
# -----------------------------------------------------
prompts:
  # é—®é¢˜æ”¹å†™ (CRAG)
  rewrite: |
    You are a question re-writer that converts an input question to a better version optimized for vectorstore retrieval.
    Input Question: {original_query}
    Output ONLY the improved question. No other text.

  # æ–‡æ¡£è´¨é‡è¯„ä¼° (CRAG)
  grade: |
    You are a grader assessing relevance of a retrieved document to a user question.
    Question: {query}
    Document: {doc_content}
    Give a binary score 'yes' or 'no'. Output only 'yes' or 'no'.

  # æœ€ç»ˆå›ç­”ç”Ÿæˆ
  generation: |
    You are a Senior Technical Expert in the Oil & Gas industry.
    Answer the user's question deeply and accurately based on the Context provided.
    
    CRITICAL INSTRUCTIONS:
    1. Answer in the SAME LANGUAGE as the question (ä¸­æ–‡é—®é¢˜ç”¨ä¸­æ–‡å›ç­”).
    2. If the Context contains specific numbers or data, cite them exactly.
    3. If you cannot find the answer in the Context, respond in the same language:
       - English: "I cannot find this information in the provided materials."
       - ä¸­æ–‡: "æ ¹æ®æä¾›çš„èµ„æ–™ï¼Œæˆ‘æ— æ³•æ‰¾åˆ°ç›¸å…³ä¿¡æ¯ã€‚"
    4. Keep your answer concise but complete.
    
    Context:
    {context}
    
    User Question: {query}
    
    Answer:

  # æ¯”è¾ƒç±»é—®é¢˜èšåˆ
  aggregation_compare: |
    Based on the retrieved information, provide a comparative analysis.
    
    Sub-questions and contexts:
    {sub_results}
    
    Original Question: {original_query}
    
    Instructions:
    1. Clearly state the values for each item being compared
    2. Use specific numbers from the context
    3. Highlight key differences
    
    Answer:

# -----------------------------------------------------
# ğŸ“Š è¯„æµ‹é…ç½®
# -----------------------------------------------------
evaluation:
  # è¯„æµ‹æ¨¡å¼
  use_llm_judge: true  # ä½¿ç”¨ LLM ä½œä¸ºè¯„åˆ¤
  
  # é€šè¿‡é˜ˆå€¼
  pass_threshold: 7    # æ»¡åˆ† 10 åˆ†ï¼Œ7 åˆ†åŠæ ¼

# -----------------------------------------------------
# ğŸ–¥ï¸ ç³»ç»Ÿé…ç½®
# -----------------------------------------------------
system:
  # æ—¥å¿—çº§åˆ«
  log_level: "INFO"
  
  # å‘é‡æ•°æ®åº“
  vector_db:
    persist_dir: ".cache/chroma_db"
    force_rebuild: false  # true = æ¯æ¬¡é‡å»ºç´¢å¼•
  
  # ç¼“å­˜
  cache:
    enabled: true
    dir: ".cache/"
